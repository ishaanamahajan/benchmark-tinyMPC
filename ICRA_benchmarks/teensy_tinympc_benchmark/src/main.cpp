#include <Arduino.h>
#undef F
#include "admm.hpp"
#include "rho_benchmark.hpp"
#include "problem_data/rand_prob_tinympc_params.hpp"  // Generated by your Python script

void setup() {
    Serial.begin(115200);
    while(!Serial) { ; }
    
    Serial.println("Starting MPC Test");
    
    // Initialize problem
    tiny_problem problem;
    tiny_params params;
    
    // Setup problem parameters
    initialize_benchmark_cache();  // Initialize your matrices
    
    // Run solver with rho adaptation
    solve_admm(&problem, &params);
    
    // Print results
    Serial.print("Final rho: "); 
    Serial.println(params.cache.rho[problem.cache_level]);
    Serial.print("Time taken: ");
    Serial.println(problem.solve_time);
}

void loop() {
    // Empty
}